{"version":3,"sources":["../src/logger.ts"],"names":[],"mappings":"8JAAA,2E;;;;;;AAMA,IAAI,YAAY;AACd,wEADF,C;;AAGA,IAAI,OAAO,GAAG,UAAS,aAAT,EAAwB,SAAxB,EAA2D;AACvE,MAAI;AACF,EAAA,OADE;AAEF,EAAA,iBAFE;AAGF,EAAA,MAHE;AAIF,EAAA,KAJE;AAKF,EAAA,UALE;AAMF,EAAA,SANE;AAOF,EAAA,MAPE;AAQA,2BAAE,SAAF,CAAY,qBAAa,IAAb,CAAkB,aAAlB,CAAZ,EAA8C,EAA9C,CARJ;;AAUA,MAAI;AACF;AACA;AACA,QAAI,wBAAwB,GAAG,yBAAE,OAAF,CAAU,MAAV,EAAkB,gCAAlB,EAAoD,IAApD,CAA/B;AACA;AACA,IAAA,MAAM,GAAG,IAAI,CAAE,IAAG,wBAAyB,GAA9B,CAAb;AACD,GAND,CAME,OAAO,GAAP,EAAY;AACZ;AACA,IAAA,SAAS,CAAC,IAAV,CAAe,yCAAf,EAA0D;AACxD,MAAA,GADwD;AAExD,MAAA,aAFwD;AAGxD,MAAA,MAHwD,EAA1D;;AAKD;;AAED;AACA,EAAA,SAAS,CAAC,IAAV,CAAe,yBAAf,EAA0C;AACxC,IAAA,GAAG,EAAE;AACH,MAAA,iBADG;AAEH,MAAA,MAFG;AAGH,MAAA,KAHG;AAIH,MAAA,UAJG;AAKH,MAAA,SALG;AAMH,MAAA,MANG,EADmC,EAA1C;;;AAUD,CArCD,C;;AAuCO,IAAI,MAAM,GAAG,UAAS,aAAT,EAAwB,SAA2B,GAAG,OAAtD,EAAqE;AACvF,MAAI;AACF,oBAAQ,aAAR,EAAuB,SAAvB;AACD,GAFD,CAEE,OAAO,GAAP,EAAY;AACZ;AACA,IAAA,SAAS,CAAC,KAAV,CAAgB,oCAAhB,EAAsD;AACpD,MAAA,GADoD;AAEpD,MAAA,aAFoD,EAAtD;;AAID;AACF,CAVM,C","file":"logger.js","sourcesContent":["import _ from 'lodash-firecloud';\n\nimport {\n  MinLog\n} from 'minlog';\n\nlet _awsLoggerRE =\n  / *\\[AWS ([^ ]+) ([^ ]+) ([^ ]+)s ([^ ]+) retries] ([^(]+)\\(([^)]+)\\).*/;\n\nlet _logger = function(awsSdkMessage, rawLogger: Console | MinLog): void {\n  let [\n    _ignore,\n    serviceIdentifier,\n    status,\n    delta,\n    retryCount,\n    operation,\n    params\n  ] = _.defaultTo(_awsLoggerRE.exec(awsSdkMessage), []);\n\n  try {\n    // 'params' is essentially an output of util.format('%o', realParams)\n    // remove the hidden property 'length' of arrays, so we can eval params back into realParams\n    let paramsWithoutArrayLength = _.replace(params, /,?\\s+\\[length\\]:\\s+\\d+(\\s+\\])/g, '$1');\n    // eslint-disable-next-line no-eval\n    params = eval(`(${paramsWithoutArrayLength})`);\n  } catch (err) {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    rawLogger.warn(\"Couldn't eval 'params' of AWS SDK call.\", {\n      err,\n      awsSdkMessage,\n      params\n    });\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  rawLogger.warn('Making an AWS SDK call.', {\n    aws: {\n      serviceIdentifier,\n      status,\n      delta,\n      retryCount,\n      operation,\n      params\n    }\n  });\n};\n\nexport let logger = function(awsSdkMessage, rawLogger: Console | MinLog = console): void {\n  try {\n    _logger(awsSdkMessage, rawLogger);\n  } catch (err) {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    rawLogger.error('Failed while tracing AWS SDK call.', {\n      err,\n      awsSdkMessage\n    });\n  }\n};\n\nexport default logger;\n"]}