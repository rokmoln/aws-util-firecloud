{"version":3,"sources":["../src/logger.js"],"names":[],"mappings":"8JAAA,2E;;AAEA,IAAI,YAAY;AACd,wEADF,C;;AAGA,IAAI,OAAO,GAAG,UAAS,aAAT,EAAwB,SAAxB,EAAmC;AAC/C,MAAI;AACF,EAAA,iBADE;AAEF,EAAA,MAFE;AAGF,EAAA,KAHE;AAIF,EAAA,UAJE;AAKF,EAAA,SALE;AAMF,EAAA,MANE;AAOA,uBAAa,IAAb,CAAkB,aAAlB,EAAiC,KAAjC,CAAuC,CAAvC,CAPJ;;AASA,MAAI;AACF;AACA;AACA,QAAI,wBAAwB,GAAG,yBAAE,OAAF,CAAU,MAAV,EAAkB,gCAAlB,EAAoD,IAApD,CAA/B;AACA;AACA,IAAA,MAAM,GAAG,IAAI,CAAE,IAAG,wBAAyB,GAA9B,CAAb;AACD,GAND,CAME,OAAO,GAAP,EAAY;AACZ,IAAA,SAAS,CAAC,IAAV,CAAe,yCAAf,EAA0D;AACxD,MAAA,GADwD;AAExD,MAAA,aAFwD;AAGxD,MAAA,MAHwD,EAA1D;;AAKD;;AAED,EAAA,SAAS,CAAC,IAAV,CAAe,yBAAf,EAA0C;AACxC,IAAA,GAAG,EAAE;AACH,MAAA,iBADG;AAEH,MAAA,MAFG;AAGH,MAAA,KAHG;AAIH,MAAA,UAJG;AAKH,MAAA,SALG;AAMH,MAAA,MANG,EADmC,EAA1C;;;AAUD,CAlCD,C;;AAoCO,IAAI,MAAM,GAAG,UAAS,aAAT,EAAwB,SAAS,GAAG,OAApC,EAA6C;AAC/D,MAAI;AACF,oBAAQ,aAAR,EAAuB,SAAvB;AACD,GAFD,CAEE,OAAO,GAAP,EAAY;AACZ,IAAA,SAAS,CAAC,KAAV,CAAgB,oCAAhB,EAAsD;AACpD,MAAA,GADoD;AAEpD,MAAA,aAFoD,EAAtD;;AAID;AACF,CATM,C","file":"logger.js","sourcesContent":["import _ from 'lodash-firecloud';\n\nlet _awsLoggerRE =\n  / *\\[AWS ([^ ]+) ([^ ]+) ([^ ]+)s ([^ ]+) retries] ([^(]+)\\(([^)]+)\\).*/;\n\nlet _logger = function(awsSdkMessage, rawLogger) {\n  let [\n    serviceIdentifier,\n    status,\n    delta,\n    retryCount,\n    operation,\n    params\n  ] = _awsLoggerRE.exec(awsSdkMessage).slice(1);\n\n  try {\n    // 'params' is essentially an output of util.format('%o', realParams)\n    // remove the hidden property 'length' of arrays, so we can eval params back into realParams\n    let paramsWithoutArrayLength = _.replace(params, /,?\\s+\\[length\\]:\\s+\\d+(\\s+\\])/g, '$1');\n    // eslint-disable-next-line no-eval\n    params = eval(`(${paramsWithoutArrayLength})`);\n  } catch (err) {\n    rawLogger.warn(\"Couldn't eval 'params' of AWS SDK call.\", {\n      err,\n      awsSdkMessage,\n      params\n    });\n  }\n\n  rawLogger.warn('Making an AWS SDK call.', {\n    aws: {\n      serviceIdentifier,\n      status,\n      delta,\n      retryCount,\n      operation,\n      params\n    }\n  });\n};\n\nexport let logger = function(awsSdkMessage, rawLogger = console) {\n  try {\n    _logger(awsSdkMessage, rawLogger);\n  } catch (err) {\n    rawLogger.error('Failed while tracing AWS SDK call.', {\n      err,\n      awsSdkMessage\n    });\n  }\n};\n\nexport default logger;\n"]}