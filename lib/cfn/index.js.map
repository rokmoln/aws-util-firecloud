{"version":3,"sources":["../../src/cfn/index.js"],"names":[],"mappings":"uIAAA,2E;;AAEO,IAAI,cAAc,GAAG,UAAS,KAAT,EAAgB;AAC1C,MAAI,CAAC,yBAAE,aAAF,CAAgB,KAAhB,CAAL,EAA6B;AAC3B,WAAO,KAAP;AACD;AACD,MAAI,IAAI,GAAG,yBAAE,IAAF,CAAO,KAAP,CAAX;AACA,MAAI,IAAI,CAAC,MAAL,KAAgB,CAApB,EAAuB;AACrB,WAAO,KAAP;AACD;AACD,SAAO,iBAAiB,IAAjB,CAAsB,IAAI,CAAC,CAAD,CAA1B,CAAP;AACD,CATM,C;;AAWA,IAAI,iBAAiB,GAAG,UAAS,GAAT,EAAc,SAAd,EAAyB;AACtD,MAAI,uBAAe,SAAf,CAAJ,EAA+B;AAC7B,QAAI,SAAS,CAAC,GAAd,EAAmB;AACjB,MAAA,GAAG,GAAG,GAAG,CAAC,MAAJ,CAAW,SAAS,CAAC,GAArB,CAAN;AACD,KAFD,MAEO,IAAI,SAAS,CAAC,YAAD,CAAb,EAA6B;AAClC;AACA,MAAA,GAAG,GAAG,GAAG,CAAC,MAAJ,CAAW,SAAS,CAAC,YAAD,CAAT,CAAwB,CAAxB,CAAX,CAAN;AACD,KAHM,MAGA,IAAI,yBAAE,QAAF,CAAW,SAAS,CAAC,SAAD,CAApB,CAAJ,EAAsC;AAC3C;AACA,UAAI,OAAO,GAAG,SAAS,CAAC,SAAD,CAAT,CAAqB,KAArB,CAA2B,cAA3B,CAAd;AACA,MAAA,OAAO,GAAG,yBAAE,MAAF,CAAS,OAAT,EAAkB,UAAS,MAAT,EAAiB;AAC3C,eAAO,WAAW,IAAX,CAAgB,MAAhB,CAAP;AACD,OAFS,CAAV;AAGA,+BAAE,OAAF,CAAU,OAAV,EAAmB,UAAS,MAAT,EAAiB;AAClC,QAAA,MAAM,GAAG,MAAM,CAAC,KAAP,CAAa,2BAAb,EAA0C,CAA1C,CAAT;AACA,QAAA,GAAG,CAAC,IAAJ,CAAS,MAAT;AACD,OAHD;AAID,KAVM,MAUA,IAAI,yBAAE,OAAF,CAAU,SAAS,CAAC,SAAD,CAAnB,CAAJ,EAAqC;AAC1C;AACA,UAAI,OAAO,GAAG,SAAS,CAAC,SAAD,CAAT,CAAqB,CAArB,EAAwB,KAAxB,CAA8B,cAA9B,CAAd;AACA,MAAA,OAAO,GAAG,yBAAE,MAAF,CAAS,OAAT,EAAkB,UAAS,MAAT,EAAiB;AAC3C,eAAO,WAAW,IAAX,CAAgB,MAAhB,CAAP;AACD,OAFS,CAAV;AAGA,UAAI,OAAO,GAAG,yBAAE,IAAF,CAAO,SAAS,CAAC,SAAD,CAAT,CAAqB,CAArB,CAAP,CAAd;AACA,MAAA,OAAO,GAAG,yBAAE,OAAF,CAAU,OAAV,EAAmB,GAAG,OAAtB,CAAV;AACA,+BAAE,OAAF,CAAU,OAAV,EAAmB,UAAS,MAAT,EAAiB;AAClC,QAAA,MAAM,GAAG,MAAM,CAAC,KAAP,CAAa,2BAAb,EAA0C,CAA1C,CAAT;AACA,QAAA,GAAG,CAAC,IAAJ,CAAS,MAAT;AACD,OAHD;AAID;AACF,GA7BD,MA6BO,IAAI,yBAAE,YAAF,CAAe,SAAf,CAAJ,EAA+B;AACpC,IAAA,GAAG,GAAG,GAAG,CAAC,MAAJ,CAAW,yBAAE,MAAF,CAAS,SAAT,EAAoB,iBAApB,EAAuC,EAAvC,CAAX,CAAN;AACD;;AAED,SAAO,GAAP;AACD,CAnCM,C","file":"index.js","sourcesContent":["import _ from 'lodash-firecloud';\n\nexport let isIntrinsicFun = function(Value) {\n  if (!_.isPlainObject(Value)) {\n    return false;\n  }\n  let keys = _.keys(Value);\n  if (keys.length !== 1) {\n    return false;\n  }\n  return /^(Fn::.*|Ref)$/.test(keys[0]);\n};\n\nexport let reduceToDependsOn = function(acc, statement) {\n  if (isIntrinsicFun(statement)) {\n    if (statement.Ref) {\n      acc = acc.concat(statement.Ref);\n    } else if (statement['Fn::GetAtt']) {\n      // {'Fn::GetAtt': ['Ref', 'Att']}\n      acc = acc.concat(statement['Fn::GetAtt'][0]);\n    } else if (_.isString(statement['Fn::Sub'])) {\n      // {'Fn::Sub': `${Ref}`}\n      let subRefs = statement['Fn::Sub'].match(/\\$\\{[^}]+\\}/g);\n      subRefs = _.reject(subRefs, function(subRef) {\n        return /^AWS::.+/.test(subRef);\n      });\n      _.forEach(subRefs, function(subRef) {\n        subRef = subRef.match(/\\$\\{([^!][^.}]+)(\\..+)?\\}/)[1];\n        acc.push(subRef);\n      });\n    } else if (_.isArray(statement['Fn::Sub'])) {\n      // {'Fn::Sub': [`${Ref}${Var}`, {Var: Value}]}\n      let subRefs = statement['Fn::Sub'][0].match(/\\$\\{[^}]+\\}/g);\n      subRefs = _.reject(subRefs, function(subRef) {\n        return /^AWS::.+/.test(subRef);\n      });\n      let subVars = _.keys(statement['Fn::Sub'][1]);\n      subRefs = _.without(subRefs, ...subVars);\n      _.forEach(subRefs, function(subRef) {\n        subRef = subRef.match(/\\$\\{([^!][^.}]+)(\\..+)?\\}/)[1];\n        acc.push(subRef);\n      });\n    }\n  } else if (_.isObjectLike(statement)) {\n    acc = acc.concat(_.reduce(statement, reduceToDependsOn, []));\n  }\n\n  return acc;\n};\n"]}