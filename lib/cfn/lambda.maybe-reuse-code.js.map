{"version":3,"sources":["../../src/cfn/lambda.maybe-reuse-code.js"],"names":[],"mappings":"6HAAA;AACA,sF;;AAEO,IAAI,cAAc,GAAG,gBAAe;AACzC,EAAA,MADyC;AAEzC,EAAA,GAFyC,EAAf;AAGzB;AACD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAI,qBAAqB,4CAAG,MAAM,qBAAyB;AACzD,QAAA,IAAI,EAAE,MAAM,CAAC,UAAP,CAAkB,IADiC;AAEzD,QAAA,YAAY,EAAE,MAAM,CAAC,UAAP,CAAkB,YAFyB;AAGzD,QAAA,GAHyD,EAAzB,CAAT,4IAAzB;;;AAMA,2BAAE,KAAF,CAAQ,MAAR,EAAgB;AACd,IAAA,UAAU,EAAE;AACV,MAAA,IAAI,EAAE;AACJ,QAAA,QAAQ,EAAE,qBAAqB,CAAC,oBAD5B;AAEJ,QAAA,KAAK,EAAE,qBAAqB,CAAC,iBAFzB,EADI;;AAKV,MAAA,WAAW,EAAE;AACX,QAAA,SAAS,EAAE,qBADA,EALH,EADE,EAAhB;;;;AAWD,CA7BM,C","file":"lambda.maybe-reuse-code.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport getCodeChecksumVariables from './lambda.get-code-checksum-variables';\n\nexport let maybeReuseCode = async function({\n  Lambda,\n  env\n}) {\n  // diffs from add\n  // - FunctionName is required\n  // - LambdaL resource is required\n  // - DependsOn is required to include LambdaL\n  // - APEX_FUNCTION_NAME: pkg.name,\n  // - LAMBDA_FUNCTION_NAME: Lambda.Properties.FunctionName\n\n  // TODO needs to be in cfn/tpl/env-api/lambda.apex.js\n  let codeChecksumVariables = await getCodeChecksumVariables({\n    Code: Lambda.Properties.Code,\n    FunctionName: Lambda.Properties.FunctionName,\n    env\n  });\n\n  _.merge(Lambda, {\n    Properties: {\n      Code: {\n        S3Bucket: codeChecksumVariables.LAMBDA_CODE_S3BUCKET,\n        S3Key: codeChecksumVariables.LAMBDA_CODE_S3KEY\n      },\n      Environment: {\n        Variables: codeChecksumVariables\n      }\n    }\n  });\n};\n\nexport default maybeReuseCode;\n"]}