{"version":3,"sources":["../src/s3.js"],"names":[],"mappings":";;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AAKA;AACA,IAAI,0CAAiB,CACnB,WADmB,EAEnB,WAFmB,EAGnB,WAHmB,EAInB,gBAJmB,EAKnB,gBALmB,EAMnB,gBANmB,EAOnB,WAPmB,EAQnB,WARmB,CAArB;;AAWA,IAAI,0CAAiB,UAAS;AAC5B,QAD4B;AAE5B,QAF4B;AAG5B;AAH4B,CAAT,EAIlB;AACD,WAAS,0BAAE,SAAF,CAAY,MAAZ,EAAoB,iBAAU,EAAC,GAAD,EAAV,CAApB,CAAT;;AAEA,MAAI,OAAQ,GAAE,MAAO,IAAG,IAAI,mBAAoB,IAAG,MAAO,EAA1D;AACA;AACA;AACA,SAAO,0BAAE,OAAF,CAAU,IAAV,CAAP;AACA,SAAO,0BAAE,OAAF,CAAU,IAAV,EAAgB,aAAhB,EAA+B,GAA/B,CAAP;AACA,SAAO,0BAAE,OAAF,CAAU,IAAV,EAAgB,KAAhB,EAAuB,GAAvB,CAAP;;AAEA,SAAO,IAAP;AACD,CAfD;;AAiBO,IAAI,sDAAuB,UAAS;AACzC,QADyC;AAEzC,QAFyC;AAGzC;AAHyC,CAAT,EAI/B;AACD;AACA,WAAU,GAAE,MAAO,IAAG,kBAAY,EAAG,EAArC;AACA,SAAO,uBAAe,EAAC,MAAD,EAAS,GAAT,EAAc,MAAd,EAAf,CAAP;AACD,CARM;;AAUA,IAAI,oEAAJ;;AAEA,IAAI,oDAAsB,UAAS;AACxC,KADwC;AAExC,KAFwC;AAGxC;AAHwC,CAAT,EAI9B;AACD,MAAI,OAAO,yBAAiB;AAC1B,YAAS,GAAE,IAAI,IAAK,IAAG,IAAI,QAAS,EADV;AAE1B,UAF0B;AAG1B;AAH0B,GAAjB,CAAX;;AAMA,SAAO,IAAP;AACD,CAZM;;AAcA,IAAI,oDAAsB,UAAS;AACxC,YADwC;AAExC,QAFwC;AAGxC;AAHwC,CAAT,EAI9B;AACD,WAAS,0BAAE,SAAF,CAAY,MAAZ,EAAoB,iBAAU,EAAC,GAAD,EAAV,CAApB,CAAT;AACA,MAAI,SAAS,yBAAiB,EAAC,MAAD,EAAS,GAAT,EAAjB,CAAb;;AAEA,SAAQ,GAAE,UAAW,IAAG,MAAO,EAA/B;AACD,CATM;;AAWA,IAAI,gCAAY,UAAS;AAC9B,QAD8B;AAE9B;AAF8B,CAAT,EAGpB;AACD,WAAS,0BAAE,SAAF,CAAY,MAAZ,EAAoB,iBAAU,EAAC,GAAD,EAAV,CAApB,CAAT;AACA,MAAI,UAAW,MAAK,MAAO,EAA3B;AACA,MAAI,WAAW,WAAf,EAA4B;AAC1B,cAAU,IAAV;AACD;AACD,MAAI,SAAS,uBAAgB,EAAC,MAAD,EAAS,GAAT,EAAhB,CAAb;AACA,SAAQ,GAAE,OAAQ,IAAG,MAAO,EAA5B;AACD,CAXM;;AAaA,IAAI,8CAAmB,UAAS;AACrC,QADqC;AAErC;AAFqC,CAAT,EAG3B;AACD,WAAS,0BAAE,SAAF,CAAY,MAAZ,EAAoB,iBAAU,EAAC,GAAD,EAAV,CAApB,CAAT;AACA,MAAI,SAAS,uBAAgB,EAAC,MAAD,EAAS,GAAT,EAAhB,CAAb;;AAEA,MAAI,MAAM,GAAV;AACA,MAAI,0BAAE,QAAF,yBAA2B,MAA3B,CAAJ,EAAwC;AACtC,UAAM,GAAN;AACD;;AAED,SAAQ,aAAY,GAAI,GAAE,MAAO,IAAG,MAAO,EAA3C;AACD,CAbM;;kBAeQ,O","file":"s3.js","sourcesContent":["import AWS_ACCOUNT from './account';\nimport _ from 'lodash-firecloud';\n\nimport {\n  get as getRegion,\n  getDomain as getRegionDomain\n} from './region';\n\n// https://docs.aws.amazon.com/general/latest/gr/rande.html#s3_website_region_endpoints\nlet _hyphenRegions = [\n  'us-east-1',\n  'us-west-1',\n  'us-west-2',\n  'ap-southeast-1',\n  'ap-southeast-2',\n  'ap-northeast-1',\n  'eu-west-1',\n  'sa-east-1'\n];\n\nlet _getBucketName = function({\n  prefix,\n  region,\n  env\n}) {\n  region = _.defaultTo(region, getRegion({env}));\n\n  let name = `${prefix}-${env.PROJECT_DOMAIN_NAME}-${region}`;\n  // as per http://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html\n  // the recommendation is NOT to use dots/uppercase\n  name = _.toLower(name);\n  name = _.replace(name, /[^a-z0-9-]/g, '-');\n  name = _.replace(name, /-+/g, '-');\n\n  return name;\n};\n\nexport let getAccountBucketName = function({\n  prefix,\n  region,\n  env\n}) {\n  // there is one bucket per AWS account\n  prefix = `${prefix}-${AWS_ACCOUNT.ID}`;\n  return _getBucketName({prefix, env, region});\n};\n\nexport let getEnvBucketName = _getBucketName;\n\nexport let getLambdaBucketName = function({\n  pkg,\n  env,\n  region\n}) {\n  let name = getEnvBucketName({\n    prefix: `${pkg.name}-${env.ENV_NAME}`,\n    region,\n    env\n  });\n\n  return name;\n};\n\nexport let getBucketDomainName = function({\n  BucketName,\n  region,\n  env\n}) {\n  region = _.defaultTo(region, getRegion({env}));\n  let domain = getWebsiteDomain({region, env});\n\n  return `${BucketName}.${domain}`;\n};\n\nexport let getDomain = function({\n  region,\n  env\n}) {\n  region = _.defaultTo(region, getRegion({env}));\n  let service = `s3-${region}`;\n  if (region === 'us-east-1') {\n    service = 's3';\n  }\n  let domain = getRegionDomain({region, env});\n  return `${service}.${domain}`;\n};\n\nexport let getWebsiteDomain = function({\n  region,\n  env\n}) {\n  region = _.defaultTo(region, getRegion({env}));\n  let domain = getRegionDomain({region, env});\n\n  let sep = '.';\n  if (_.includes(_hyphenRegions, region)) {\n    sep = '-';\n  }\n\n  return `s3-website${sep}${region}.${domain}`;\n};\n\nexport default exports;\n"]}