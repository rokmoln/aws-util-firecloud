{"version":3,"sources":["../src/s3.ts"],"names":[],"mappings":"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","file":"s3.js","sourcesContent":["import AWS_ACCOUNT from './account';\nimport _ from 'lodash-firecloud';\n\nimport {\n  get as getRegion,\n  getDomain as getRegionDomain\n} from './region';\n\nimport {\n  Env,\n  Region\n} from './types';\n\n// https://docs.aws.amazon.com/general/latest/gr/rande.html#s3_website_region_endpoints\nlet _hyphenRegions = [\n  'us-east-1',\n  'us-west-1',\n  'us-west-2',\n  'ap-southeast-1',\n  'ap-southeast-2',\n  'ap-northeast-1',\n  'eu-west-1',\n  'sa-east-1'\n];\n\nlet _getBucketName = function({\n  prefix,\n  env,\n  region\n}: {\n  prefix: string;\n  env: Env;\n  region?: Region;\n}): string {\n  region = _.defaultTo(region, getRegion({env}));\n\n  let name = `${prefix}-${env.PROJECT_DOMAIN_NAME}-${region}`;\n  // as per http://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html\n  // the recommendation is NOT to use dots/uppercase\n  name = _.toLower(name);\n  name = _.replace(name, /[^a-z0-9-]/g, '-');\n  name = _.replace(name, /-+/g, '-');\n\n  return name;\n};\n\n// one per whole project (like builds- or infra-)\nexport let getProjectBucketName = function({\n  prefix,\n  env,\n  region\n}: {\n  prefix: string;\n  env: Env;\n  region?: Region;\n}): string {\n  return _getBucketName({prefix, env, region});\n};\n\n// one per AWS account (like logs- or config-)\nexport let getAccountBucketName = function({\n  prefix,\n  env,\n  region\n}: {\n  prefix: string;\n  env: Env;\n  region?: Region;\n}): string {\n  prefix = `${prefix}-${AWS_ACCOUNT.ID}`;\n  return _getBucketName({prefix, env, region});\n};\n\n// one per ENV_NAME (like lambda buckets)\nexport let getEnvBucketName = function({\n  prefix,\n  env,\n  region\n}: {\n  prefix: string;\n  env: Env;\n  region?: Region;\n}): string {\n  prefix = `${prefix}-${env.ENV_NAME}`;\n  return _getBucketName({prefix, env, region});\n};\n\nexport let getBucketDomainName = function({\n  BucketName,\n  env,\n  region\n}: {\n  BucketName: string;\n  env: Env;\n  region?: Region;\n}): string {\n  region = _.defaultTo(region, getRegion({env}));\n  let domain = getWebsiteDomain({region, env});\n\n  return `${BucketName}.${domain}`;\n};\n\nexport let getDomain = function({\n  env,\n  region\n}: {\n  env: Env;\n  region?: Region;\n}): string {\n  region = _.defaultTo(region, getRegion({env}));\n  let service = `s3-${region}`;\n  if (region === 'us-east-1') {\n    service = 's3';\n  }\n  let domain = getRegionDomain({region, env});\n  return `${service}.${domain}`;\n};\n\nexport let getWebsiteDomain = function({\n  env,\n  region\n}: {\n  env: Env;\n  region?: Region;\n}): string {\n  region = _.defaultTo(region, getRegion({env}));\n  let domain = getRegionDomain({region, env});\n\n  let sep = '.';\n  if (_.includes(_hyphenRegions, region)) {\n    sep = '-';\n  }\n\n  return `s3-website${sep}${region}.${domain}`;\n};\n"]}